<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Models\HajjJob;
use App\Models\Department;

class SetupMeccaJobs extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'setup:mecca-jobs {--force : Force creation even if jobs exist}';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Ø¥Ø¶Ø§ÙØ© ÙˆØ¸Ø§Ø¦Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„';

    /**
     * Execute the console command.
     */
    public function handle()
    {
        $this->info('ðŸ•‹ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© ÙˆØ¸Ø§Ø¦Ù Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©...');

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙˆØ¸Ø§Ø¦Ù Ù…ÙƒØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        $existingMeccaJobs = HajjJob::where('region', 'mecca')->count();
        
        if ($existingMeccaJobs > 0 && !$this->option('force')) {
            $this->warn("âš ï¸ ÙŠÙˆØ¬Ø¯ {$existingMeccaJobs} ÙˆØ¸ÙŠÙØ© ÙÙŠ Ù…ÙƒØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹.");
            
            if (!$this->confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ØŸ')) {
                $this->info('ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡.');
                return 0;
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø³Ù… Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­Ø¬
        $department = Department::firstOrCreate([
            'name' => 'Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­Ø¬'
        ], [
            'description' => 'Ù‚Ø³Ù… Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­Ø¬ ÙˆØ§Ù„Ø¹Ù…Ø±Ø© - ÙˆØ¸Ø§Ø¦Ù Ù…ÙˆØ³Ù…ÙŠØ©'
        ]);

        $this->info("ðŸ“‹ Ø§Ù„Ù‚Ø³Ù…: {$department->name}");

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
        $jobs = [
            [
                'title' => 'Ù…Ø±Ø´Ø¯ Ø­Ø¬ ÙˆÙ…Ø³Ø§Ø¹Ø¯ Ø­Ø¬Ø§Ø¬',
                'description' => 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø­Ø¬Ø§Ø¬ ÙˆØªÙˆØ¬ÙŠÙ‡Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ù‚Ø¯Ø³Ø©. Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ ÙØ±ÙŠÙ‚ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„Ù„Ø­Ø¬Ø§Ø¬ ÙˆØ¶Ù…Ø§Ù† Ø±Ø§Ø­ØªÙ‡Ù… ÙˆØ³Ù„Ø§Ù…ØªÙ‡Ù… Ø£Ø«Ù†Ø§Ø¡ ØªØ£Ø¯ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ùƒ.',
                'location' => 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© - Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ù‚Ø¯Ø³Ø©',
                'employment_type' => 'temporary',
                'salary_min' => 3000,
                'salary_max' => 5000,
                'requirements' => 'Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­Ø¬Ø§Ø¬ØŒ Ø¥Ø¬Ø§Ø¯Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©ØŒ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©',
                'benefits' => 'Ø±Ø§ØªØ¨ Ø´Ù‡Ø±ÙŠØŒ Ø³ÙƒÙ†ØŒ ÙˆØ¬Ø¨Ø§ØªØŒ Ù…ÙˆØ§ØµÙ„Ø§ØªØŒ ØªØ£Ù…ÙŠÙ† Ø·Ø¨ÙŠ',
                'max_applicants' => 50,
            ],
            [
                'title' => 'Ù…Ù†Ø¸Ù… Ø­Ø´ÙˆØ¯ ÙÙŠ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ù…ÙƒÙŠ',
                'description' => 'ØªÙ†Ø¸ÙŠÙ… Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø¬Ø§Ø¬ ÙˆØ§Ù„Ø²ÙˆØ§Ø± ÙÙŠ Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ù…ÙƒÙŠ Ø§Ù„Ø´Ø±ÙŠÙØŒ ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø·ÙˆØ§Ù ÙˆØ§Ù„Ø³Ø¹ÙŠ Ø¨Ø£Ù…Ø§Ù† ÙˆØ§Ù†Ø³ÙŠØ§Ø¨ÙŠØ©.',
                'location' => 'Ø§Ù„Ø­Ø±Ù… Ø§Ù„Ù…ÙƒÙŠ Ø§Ù„Ø´Ø±ÙŠÙ',
                'employment_type' => 'temporary',
                'salary_min' => 3500,
                'salary_max' => 4500,
                'requirements' => 'Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­Ø´ÙˆØ¯ØŒ Ø§Ù„ØµØ¨Ø±ØŒ Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ù…ØªØ§Ø²Ø©',
                'benefits' => 'Ø±Ø§ØªØ¨ ØªÙ†Ø§ÙØ³ÙŠØŒ ÙˆØ¬Ø¨Ø§ØªØŒ Ù…ÙˆØ§ØµÙ„Ø§ØªØŒ ØªØ£Ù…ÙŠÙ† Ø´Ø§Ù…Ù„',
                'max_applicants' => 30,
            ],
            [
                'title' => 'Ù…Ø´Ø±Ù Ù†Ø¸Ø§ÙØ© ÙˆØµØ­Ø© Ø¹Ø§Ù…Ø©',
                'description' => 'Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø¹Ù„Ù‰ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ø¸Ø§ÙØ© ÙˆØ§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙŠ Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ø­Ø¬ØŒ ÙˆØ¶Ù…Ø§Ù† Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØµØ­ÙŠØ© Ù„Ù„Ø­Ø¬Ø§Ø¬.',
                'location' => 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© - Ù…Ø±Ø§ÙÙ‚ Ø§Ù„Ø­Ø¬',
                'employment_type' => 'temporary',
                'salary_min' => 2800,
                'salary_max' => 4000,
                'requirements' => 'Ø®Ø¨Ø±Ø© ÙÙŠ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©ØŒ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·ØŒ Ø§Ù„Ø¹Ù…Ù„ ØªØ­Øª Ø¶ØºØ·',
                'benefits' => 'Ø±Ø§ØªØ¨ Ø´Ù‡Ø±ÙŠØŒ Ø³ÙƒÙ† Ù…Ø¤Ù‚ØªØŒ ÙˆØ¬Ø¨Ø§ØªØŒ Ù…ÙƒØ§ÙØ¢Øª',
                'max_applicants' => 40,
            ],
            [
                'title' => 'Ù…ÙˆØ¸Ù Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØ®Ø¯Ù…Ø© Ø­Ø¬Ø§Ø¬',
                'description' => 'Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø­Ø¬Ø§Ø¬ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø± ÙˆØ§Ù„ÙÙ†Ø§Ø¯Ù‚ØŒ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù„Ø§Ø²Ù…Ø©ØŒ ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø­ØµÙˆÙ„Ù‡Ù… Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.',
                'location' => 'Ù…Ø·Ø§Ø± Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² - Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©',
                'employment_type' => 'temporary',
                'salary_min' => 3200,
                'salary_max' => 4200,
                'requirements' => 'Ø¥Ø¬Ø§Ø¯Ø© Ù„ØºØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŒ Ù…Ù‡Ø§Ø±Ø§Øª Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ù…Ø¸Ù‡Ø± Ù…Ù†Ø§Ø³Ø¨',
                'benefits' => 'Ø±Ø§ØªØ¨ Ø¬ÙŠØ¯ØŒ Ù…ÙˆØ§ØµÙ„Ø§ØªØŒ ÙˆØ¬Ø¨Ø§ØªØŒ Ø¨Ø¯Ù„ Ù„ØºØ§Øª',
                'max_applicants' => 25,
            ],
            [
                'title' => 'Ø³Ø§Ø¦Ù‚ Ø­Ø§ÙÙ„Ø§Øª Ø­Ø¬Ø§Ø¬',
                'description' => 'Ù‚ÙŠØ§Ø¯Ø© Ø­Ø§ÙÙ„Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø­Ø¬Ø§Ø¬ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ù‚Ø¯Ø³Ø© ÙˆØ§Ù„ÙÙ†Ø§Ø¯Ù‚ØŒ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ø±Ø§Ø­Ø© Ù„Ù„Ø±ÙƒØ§Ø¨.',
                'location' => 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© - Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ù‚Ø¯Ø³Ø©',
                'employment_type' => 'temporary',
                'salary_min' => 4000,
                'salary_max' => 6000,
                'requirements' => 'Ø±Ø®ØµØ© Ù‚ÙŠØ§Ø¯Ø© Ø¹Ø§Ù…Ø© Ø³Ø§Ø±ÙŠØ©ØŒ Ø®Ø¨Ø±Ø© ÙÙŠ Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø§ØªØŒ Ù…Ø¹Ø±ÙØ© Ø·Ø±Ù‚ Ù…ÙƒØ©',
                'benefits' => 'Ø±Ø§ØªØ¨ Ø¹Ø§Ù„ÙŠØŒ Ù…ÙƒØ§ÙØ¢Øª Ø£Ø¯Ø§Ø¡ØŒ ØªØ£Ù…ÙŠÙ†ØŒ ÙˆÙ‚ÙˆØ¯',
                'max_applicants' => 20,
            ]
        ];

        $bar = $this->output->createProgressBar(count($jobs));
        $createdCount = 0;

        foreach ($jobs as $jobData) {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            $jobData['department_id'] = $department->id;
            $jobData['application_deadline'] = now()->addDays(30);
            $jobData['status'] = 'active';
            $jobData['region'] = 'mecca';
            $jobData['application_type'] = 'open';
            $jobData['requires_registration'] = false;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹
            $exists = HajjJob::where('title', $jobData['title'])
                ->where('region', 'mecca')
                ->exists();
                
            if (!$exists) {
                HajjJob::create($jobData);
                $createdCount++;
            }
            
            $bar->advance();
        }

        $bar->finish();
        $this->newLine();

        // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
        $medinajobExists = HajjJob::where('title', 'Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©')
            ->where('region', 'medina')
            ->exists();
            
        if (!$medinajobExists) {
            HajjJob::create([
                'department_id' => $department->id,
                'title' => 'Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©',
                'description' => 'Ø¥Ø±Ø´Ø§Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± ÙÙŠ Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ Ø§Ù„Ø´Ø±ÙŠÙ ÙˆØ§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©.',
                'location' => 'Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ Ø§Ù„Ø´Ø±ÙŠÙ',
                'employment_type' => 'permanent',
                'salary_min' => 5000,
                'salary_max' => 7000,
                'requirements' => 'Ø´Ù‡Ø§Ø¯Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ø£Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø¥Ø¬Ø§Ø¯Ø© Ù„ØºØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©',
                'benefits' => 'Ø±Ø§ØªØ¨ Ø«Ø§Ø¨ØªØŒ ØªØ£Ù…ÙŠÙ† Ø·Ø¨ÙŠØŒ Ø¥Ø¬Ø§Ø²Ø§Øª Ø³Ù†ÙˆÙŠØ©',
                'application_deadline' => now()->addDays(45),
                'max_applicants' => 10,
                'status' => 'active',
                'region' => 'medina',
                'application_type' => 'registered',
                'requires_registration' => true,
            ]);
            
            $this->info('ðŸ•Œ ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø© (ØªØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„)');
        }

        $this->newLine();
        $this->info("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ {$createdCount} ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©");
        $this->info('ðŸ”¥ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ù…ÙØ¹Ø¯Ø© Ù„Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„!');
        
        $this->table(
            ['Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù', 'Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…'],
            [
                ['Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', HajjJob::where('region', 'mecca')->count(), 'Ù…ÙØªÙˆØ­ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„'],
                ['Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', HajjJob::where('region', 'medina')->count(), 'ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„'],
                ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ', HajjJob::count(), 'Ù…ØªÙ†ÙˆØ¹']
            ]
        );

        return 0;
    }
}
