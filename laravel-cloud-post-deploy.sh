#!/bin/bash

# Ø³ÙƒØ±ÙŠØ¨Øª Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø± ÙÙŠ Laravel Cloud
# ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ÙƒÙ„ Ù†Ø´Ø±

echo "ðŸš€ ØªØ·Ø¨ÙŠÙ‚ ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø±..."

# 1. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‡Ø¬Ø±Ø§Øª
echo "ðŸ“Š ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‡Ø¬Ø±Ø§Øª..."
php artisan migrate --force

# 2. Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ sessions Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
echo "ðŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ sessions..."
php artisan session:table --force 2>/dev/null || true
php artisan migrate --force

# 3. Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù‚Ø¯ÙŠÙ…
echo "ðŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù‚Ø¯ÙŠÙ…..."
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# 4. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø¬Ø¯ÙŠØ¯
echo "âš¡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø¬Ø¯ÙŠØ¯..."
php artisan config:cache
php artisan route:cache
php artisan view:cache

# 5. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
echo "ðŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©..."
php artisan optimize

# 6. ØªØ·Ø¨ÙŠÙ‚ Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ù…ÙˆØ­Ø§Ù‹)
echo "ðŸ” ØªØ·Ø¨ÙŠÙ‚ Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª..."
chmod -R 755 storage bootstrap/cache 2>/dev/null || true

# 7. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
echo "ðŸ‘¤ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª..."
php artisan db:seed --class=RolesAndPermissionsSeeder --force 2>/dev/null || true

# 8. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
echo "ðŸ“ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©..."
php artisan db:seed --class=HajjJobsSeeder --force 2>/dev/null || true

echo "âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!"
echo ""
echo "ðŸŽ¯ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:"
echo "  âœ“ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø®Ø·Ø£ 419 CSRF"
echo "  âœ“ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø³Ø±Ø¹Ø©"
echo "  âœ“ ØªØ­Ø³ÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Session"
echo "  âœ“ ØªØ­Ø³ÙŠÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
echo "  âœ“ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ø³Ù†"
echo ""
echo "ðŸŒŸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!" 